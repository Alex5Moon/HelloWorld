首先讲一下，这一期的内容非常偏，这篇内容是我昨天的那篇文章《苹果换“芯”，一次成功的大迁徙》删掉的部分。昨天那篇文章写的太长了。这个公众号里的文章，都是我感兴趣的文章，写着写着写多了。


这个公众号是我个人搞的，现在还挺有写作的冲动，但是没啥写作的才能，因为最多的一篇文章只有67次阅读。我录音也很简单，就是用一个手机录音，录完音再加个背景音乐就发出来。结果，昨天录的太多了，因为稿子写着写着，写多了，唠唠叨叨的录了45分钟，等我要发布的时候，微信公众号说不能超过30分钟。

我就开始删稿子，一直精简到16分钟，因为删除最多的部分就是指令集这里。我觉得还挺可惜的。因此今天就单独拿出来说说指令集。这个非常的小众，估计只有我这种35岁了，还喜欢写软件的人才感兴趣吧。

这里面我讲的很多技术细节，都是来自John和David那本著名的书，如果读计算机的也许知道，叫《计算机体系结构：量化研究方法》，这本书非常好，如果听众中有年轻人的话，推荐买回来好好读读。我本人并没有实际的研发CPU的经验，虽然我很想我能够研发CPU，所以我对CPU的理解，仅限于书本的知识。像在Intel，AMD或者国内研发龙芯的，我都非常的敬佩，很可惜，我可能没机会接触CPU研发了，毕竟我这岁数，而且一直写软件。
1
Intel vs 摩托罗拉
好了，开始讲CPU的指令集。

现在能在CPU领域呼风唤雨的公司是Intel，但是如果时光倒流到80年代，Intel公司远远没有这么风光，当时横亘在Intel的面前的，是大名鼎鼎的摩托罗拉公司。当Intel公司推出让他扬名立万的8086CPU的时候，同期，摩托罗拉推出的68000CPU的性能是Intel 8086的5倍。Intel奋发图强，于1982年推出80286的CPU，试图挽回颜面，结果摩托罗拉推出了68010CPU在性能上又将Intel打的满地找牙。接下来的几年内，摩托罗拉始终在技术上压制着Intel，一直到80386的时候，摩托罗拉在技术上还是有不少优势。

在这里，讲一个怎么玩心机的八卦。Intel推出的第一代CPU叫8086，按照编号的话，第二代CPU应该叫80186，但是Intel并没有这么搞，他第二代CPU直接叫80286，80186这个编号留给另外一个不重要的芯片。还有就是甲骨文公司，第一个数据库版本就是2.0版本，1.0根本就没用。也就是说，在科技界，心机婊也是万能的。

以前的人，比较实在，比如火狐啊，IE啊，都是从1.0， 1.1， 1.2这样升级，等发很重大的版本，才会跳一个版本，比如2.0，然后3.0，只有有了重大的变化，才会有一个整数的版本号出来。以前每当火狐发整数版本的时候，比如3.0， 4.0这种版本的时候，IE项目组都会给他们一个蛋糕庆祝。后来火狐发的越来越频繁，IE项目组送的蛋糕越来越小，最后就是个茶杯蛋糕，一口就能吃下去。再后来Google的Chrome加入了浏览器战斗，完全不按照常理出牌，版本号随意升，结果才几年时间，Chrome的版本号已经到了50点几。火狐一看，我去哦，也学Chrome，现在火狐的版本也是50左右了。以前得好几年才从3.0升到4.0。

但是从心理学上说，版本号越大，大家就会觉得功能越强大。现在火狐和chrome版本号之争，貌似chrome暂时领先，不排除火狐下一个版本从100开始...

有时候，不能光玩技术，也得玩心机。你看人家甲骨文，第一个版本就是2.0。这个也很重要。

后来IBM公司帮了Intel和微软，摩托罗拉的最主要客户竟然只剩下了苹果，上一期公众号里的故事就是讲苹果和摩托罗拉也分手了，摩托罗拉彻底退出CPU市场。这个摩托罗拉衰落的事情，我也有故事可以讲，一句话就是富不过三代。摩托罗拉是个家族企业，CEO都是有血缘关系的，基因没遗传好，CEO一个比一个逗逼，当然，这是衰落以后的马后炮，不过，他们的CEO一个比一个弱确实真的。

但是，我还是那个观点，如果当年IBM把CPU的订单给了摩托罗拉，也许现在的摩托罗拉就是今天的Intel，这个都不好说，有时候成功的因素都很意外，我也不能把摩托罗拉黑的太惨。

2
精简指令集 vs 复杂指令集
稍微的重复上一期的内容，让这个故事连贯一点。

当今的CPU指令分为复杂指令集和精简指令集两种。一个计算机程序，最终要变成CPU可以识别的指令，CPU才能运行。对了，我在B站上刚刚上传了一个编程视频，就是讲Python的代码，如何变成低级的指令，然后在Python虚拟机执行的，有点在讲编译原理的意思，语法怎么生成语法树，这么个视频我本以为至少10次观看吧，结果现在观看量是3次，看来真是没几个人喜欢研究这么底层的东西。

每个处理器支持的指令集是不同的，Intel在设计的时候，尽量多的支持各种不同的指令，杂七杂八的都支持。但是，这么做是有缺点的，第一，制造起来很困难，各种逻辑电路都很复杂，但是Intel制造工艺在CPU界是最先进的，这一个缺点Intel解决的挺好，但是，这么高的集成度，会造成非常大的功耗，这一个，Intel也束手无策，所以，在手机时代，他的atom芯片就不好使了；第二，因为复杂指令集的指令数相当多，因此每个指令执行的时间长短不一，比如有的长度是5，有的长度是10，结果会导致不必要的等待。

正因为这些缺点，所以才有了精简指令集的解决方法。精简指令集的主要思路是：第一，只保留很少的精简指令，复杂的指令分解成精简的指令。第二，所有的指令长度都是相同的，每次执行的时间都相同，不用等待。

但是可惜就可惜在这个地方，提出精简指令集的时候，Intel早就使用复杂指令集开始造CPU了，理论好是好，时间不凑巧。因此Intel只好硬着头皮继续坚守复杂指令集。因为只要不是技术控，就是那种觉得技术好就能决定一切的人，肯定会做出和Intel一样的决定。首先，Intel在市场上已经取得了优势，而且这个优势是基于复杂指令集取得的，如果现在放弃复杂指令集，无异于自杀。其次，做精简指令集的厂商多如牛毛，做复杂指令集的当时只有Intel，AMD那时候还没有呢。虽然说Intel坚守复杂指令集，看起来是在科学发展的道路上逆行，有点不遵守科学发展观的意思。但是，先活着肯定比死了好，到时候复杂指令集玩不动了再说，可以边坚守复杂指令集，边研发精简指令集，两手抓，两手都要硬，摸着石头过河。后来Intel确实推出过精简指令集的CPU，那款CPU的名字叫80860，结果根本没人买。Intel这才放心了，一颗石头落了地。

因为是看别人的历史，当事后诸葛亮总是比较爽的事儿，我们可以来复盘一下。当年Intel自己一个人坚守复杂指令集。当时支持精简指令的五大金刚，太阳公司，SGI公司，IBM公司，DEC公司还有惠普公司，这都是强于Intel公司。如果单纯从兵力对比上看，简直就是一只小猪战群狼。哪一个公司都有机会把Intel弄的死死的，但是，后来我们也知道了，这五个公司被Intel打的满地找牙。为啥呢？因为各自为战啊！国内国外一个德行。这种事情，根本就不可能团结的。万众一心都是赢了以后才能扯的虎皮。

比如说，我们说一下目前的手机市场，谁是最终目标：当然是苹果公司了。苹果公司一家坚守iOS，起码有100家坚守安卓。你说这100家会齐心协力干苹果么？当然不会了，不先打出一个草头王，肯定不会和苹果正面交锋！所以，这些公司先要互相打，最后的胜者才能和苹果决斗。不过很有可能的结局就是，这100家安卓手机厂商，自己决斗的时候，互相干的流血不止，自己先挂了。

如果大家喜欢看历史的话，比如说明朝为啥败给清朝，根本不是兵力不行，明朝的兵力多着呢，好好打的话，清朝没太大机会。但是，明朝有个问题，谁是正牌皇上呢？反正正牌皇上死了，已经上吊死了，自己先选出一个来呗。结果，选这个你不愿意，选那个我不愿意，自己先打起来了。等到互相之间打的差不多了，草头王也打的虚弱了，清朝过来了。

历史就是这样不停的重复，当然了，我在这里当事后诸葛亮放马后炮指点江山还是挺爽的！

3
分久必合
最后，再来谈一个问题，我看很多人都问这么一个问题：当前x86架构落后了么？其实这个问题问的就不好，因为x86架构根本没有落后，这个问题应该这么问：x86架构还能领先多久？ 会更好一点。

类似的，我们不能提这样的问题：德国足球队落后了么？人家德国足球队一直没有落后好不好。

推荐看看我在上面看的那本书——《计算机体系结构：量化研究方法》——这本书里的内容很多，如果感兴趣的话，读起来非常的有趣。

不论X86，Arm，还是MIPS，最底层的实现，其实和架构没啥关系。很难在x86或者Arm上有啥独占的技术，其它的架构不能用。打个比方来说，基础的理论研究，比如说分支预测器技术，这种底层技术类似于高速公路，ARM和x86两种架构，类似于两辆跑车，高速公路好了，两辆车跑的都快。比如gshare分支预测技术，两家都可以使用，这都是科学家的贡献，基础科学。

现在这两种指令集之争，精简指令集和复杂指令集的争论已经平息了，为啥平息了呢？因为现在技术先进了，最底层的微结构和实现，已经统一了这两种架构，这两种结构已经水乳交融了。再争论这个，显得很落伍了。争来争去的，最后统一了，真是分久必合，合久必分啊。

还有就是微结构方面，也差不多没啥潜力好挖了，毕竟乱序执行的CPU这个理论提出了快80年了，很难再有大的突破，现在的工程师也是一点点的啃这个性能。

以后的CPU性能从哪里突破呢？关于预测，我是不太敢预测的，因为一预测就打脸，但是我还是试着猜猜吧，可能以后CPU的大突破会在并行运算的领域。

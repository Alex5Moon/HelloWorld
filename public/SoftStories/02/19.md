每年的5到6月，在一望无际的非洲大草原上，数百万只食草动物，为了生存，跟随着雨水和青草，往返跋涉6000多公里，从坦桑尼亚的塞伦盖蒂大草原，一直跋涉到肯尼亚的马塞马拉大草原。途中要躲过狮子的追扑，要躲过鳄鱼的伏击。每年这漫长的迁徙中，陪伴这些食草动物的是饥饿，是惊吓，是死亡，只有30%的动物能侥幸回到出发的地点，70%的动物在跋涉途中丢了自己的性命。这是大自然的死亡之旅，同时也是新生之旅，超过40万鲜活的生命，在这次迁徙出生。 生命就是这样神奇，诞生和死亡如影随形...

在科技的历史上，也有无数的迁徙，有无数的死亡，幸存者踏着死亡者的尸骨，艰难跋涉，共同创造了我们现在这个繁荣的科技时代。迁徙失败者如Plam，如康柏，如Nokia，留给我们的是回忆，是遗产。物竞天择，适者生存，迁徙成功者带给我们的是科技的繁荣。
1
苹果宣布换“芯”
时光回到2005年的6月6日，刚刚接受完手术，略显憔悴的乔布斯心高气满的登上了WWDC舞台，用他一贯平静且具有煽动性的语调告诉台下的观众：苹果公司决定将整条Mac产品线从PowerPC芯片迁移到Intel芯片上。台下的观众一如既往的掌声雷动。
2
两种CPU架构
为什么换一个CPU就会让台下的观众如此的疯狂呢？这个要从最开始的地方说起。

在1965年，有一个叫摩尔的化学博士，随便发表了一片文章，这片文章没有实验，没有论证，没有公式，只有预测，他预测在至多十年内，集成电路的集成度会两年翻一番。后来又修正成每18个月翻一番。虽然这个预测令人难以置信，但是，几十年来，IT行业竟然始终遵循着摩尔定律预测的速度。这个化学博士随后创立Intel公司，一个叱咤风云五十年的公司就这样诞生了。

Intel刚刚诞生的时候，作为一个新公司，远没有现在这么呼风唤雨，Intel大多数时候都是卖内存，偶尔能造一下CPU，相比于CPU，内存是一种低技术含量的东西。但是这并不妨碍Intel对外宣称自己是CPU厂商。

一家伟大的公司，就像草原上幸存的角马一样，需要的可不仅仅是实力，还需要很好的运气。在1981年，IBM开发出了第一台个人电脑，一下子捧红了两个合作伙伴，一个是微软，另一个就是Intel。当时IBM并没有太看重个人电脑这个小玩意儿，随手就把CPU设计的任务交给了Intel，当时Intel举全公司之力，甚至不惜关掉自己的内存部门，全力设计8086这款CPU，这款CPU以及后面的几款CPU，奠定了目前市场上的主流框架之一x86框架。

3
两种架构的优点缺点
在写这片稿子的时候，我前思后想，因为这是我自己的公众号，对阅读量和转发率并没有任何的要求，虽然越多越好，但是少一点和多一点，对我并不会产生实质的影响，所以，决定破例大谈一下技术，即使可能有人决定取消关注。

因为CPU架构这个知识太重要了。尤其是关注我微信公众号的程序员们，一定要知道CPU的架构是怎么回事儿。如果作为一个程序员你都不知道CPU的架构，那你和项目经理有什么区别？

远在Intel成立之前的十几年，CPU的理论就开始发展并且完善，市场上也做出了各种各样的CPU。但是CPU随着理论研究的深入，越深入就越复杂，也越难以制造。市场的需求是CPU越快越好，这个毫无疑问的，CPU快慢取决于两个方面，一个是CPU本身硬件上够不够快，另一个取决于编译器够不够快。如果CPU硬件本身够快，但是编译器很烂，相当于法拉利开上了泥巴路，有劲也使不出来。

不幸的是，当时就遇到这种情况，编译器生成的机器码不好，执行的效率远没有人手工写的机器码好。事物的两面性，手工写机器码，快是快，但是太难了，也太繁琐了。这就是一个巨大的矛盾，用我们政治书上学的话就是：人民群众日益增长的物质需求与落后的编译器之间的矛盾。

有困难，就得想办法解决。那怎么办呢？当时想出的一个方法是，CPU硬件里加入更高级的指令，让一条高级指令相当于几条低级指令。写一条高级指令，相当于10条低级指令。这样手写机器码的时候，总是方便一些的。

人民群众的智慧是无穷的，这种方法相当于毛主席讲一句话顶一万句，高级指令一句话顶10句。有了指导思想，这些CPU设计厂商，把芯片的逻辑设计的越来越复杂，硬件上复杂了，支持了高级指令，手写指令的痛苦相应的也就就减小了。

所以，这最终还是个取舍的问题，硬件上复杂了，软件上轻松；软件上复杂了，硬件上轻松。有没有软件硬件上一起轻松的？抱歉，还真没有。当时不少CPU厂商就卯足了劲，不到南墙不回头，死磕硬件的逻辑电路，怎么复杂怎么来，尽量让软件方面简单，让程序员手写机器码的难度降低。

此一时彼一时，三十年河东三十年河西，到了20世纪70年代，计算机行业有了长足的进步，内存变大了，也便宜了，更重要的是，编译理论取得了突破，编译器编译出来的代码，和人工手写机器码的性能已经是伯仲之间。越来越多的人意识到，以后不可能再让人手写机器码，比如说，我想包括我在内的听众，应该没有人可以手写机器码来编程的。都是使用编程语言，然后让编译器生成机器码，根本不用再手写机器码了。

既然编译器这么厉害，不用手写机器码了，那软件方面的压力已经减小了，是不是也应该把硬件方面的压力也减小一些呢？比如说，以前CPU厂家设计的那么多复杂的逻辑电路，是不是也该放弃了？基于这种思路，精简指令集的理论提出来了，学名叫RISC，精简指令集；原来那种有复杂逻辑电路的CPU叫CISC，复杂指令集。

4
两种架构的支持者开始商战
当然，按照人类的一贯操性，这两派肯定是互相不服的，既然谈不拢，就战场上见了。Intel公司当时已经造出了x86的CPU，而精简指令集还是理论上的纸上谈兵。Intel肯定坚守复杂指令集。当时Intel作为复杂指令集的盟主，拉拢的对象是大批个人电脑厂商，基本上，只要不买苹果电脑，肯定就是复杂指令集的CPU。而当时包括Sun的Spark架构，以及IBM的Power架构，是精简指令集的阵营，拉拢的个人电脑厂商主要是苹果。

这两派阵营打的也是难分难解，明争暗斗，大批的厂商来凑热闹，包括微软的Windows NT 3.51操作系统，SUN的Solaris操作系统，IBM的AIX操作系统，都可以运行到PowerPC上，而且那时候也流行跑分，一跑分，这些精简指令集的CPU都超过Intel的复杂指令集。技术很高，但是，普通的老百姓根本不管这个，光有操作系统有啥用，我的游戏能玩么？我的软件能用么？结果大部分都不能用，光有操作系统可以用，老百姓如果买回当时精简指令集的电脑回去，只能回家开机关机玩，啥软件也不能运行，销量自然惨淡。

在用户的选择下，精简指令集遭遇了巨大的打击，光有操作系统，没有用户软件，老百姓还是不认可的。

但是IBM公司当然不肯善罢甘休了，让一家巨头痛痛快快认输是不可能的，更别说有钱有面子还有尊严的巨头了，IBM出师不利以后，给出的回答是：接着干！他拉拢了摩托罗拉和苹果，以及微软这三家公司，加上自己，组成了精简指令集的四人帮。微软当时是拉拢的主要对象之一，只要忽悠住了微软，wintel联盟就瓦解了，一箭双雕的事情太爽了！

微软也决定将Windows NT系统移植到精简指令集的CPU上，结果，本打算这款操作系统能在1991年发布，结果跳票到1995年才发布，跳票了整整四年的时间，而且bug巨多，根本没法用。

所以，就像前面所说的，当比尔盖茨听说苹果只用了一年就完成了CPU的迁移，一贯刀子嘴的盖茨，竟然对苹果也说出了赞扬的话，总体来说，苹果干的还是不错的。因为当年微软干过换“芯”的事儿，可惜干砸了！谁都没想到苹果只用了一年时间，干脆利索的就把这事儿给办成了。

5
苹果为什么换“芯”？
上文说到，精简指令这么好，为啥苹果要换CPU呢？

主要还是PowerPC芯片的价格太高了。刚开始PowerPC还有一些优势，但是，Intel这种有钱的大公司，连我们都能看出精简指令有一定的优势，他们自然心知肚明，只是嘴上不说而已。

Intel后来砸钱做研究，发现了一个好的方法，将复杂指令在CPU内部改成精简指令，这就是Pentium Pro的做法，读一条x86的复杂指令，马上分解成精简指令的风格，因此，有了技术突破的Intel，在技术上一点都不比精简指令集落后，又加上Intel在制造技术上甩摩托罗拉几条街，PowerPC不但在指令集上的优势没有了，反而散热不行的劣势更加显露无疑。因此在使用PowerPC芯片的后期，苹果电脑的散热一直是大问题。另一阵营的Intel可以大规模量产CPU，成本比PowerPC的CPU，便宜了一大截。

乔布斯终于忍不住了，打电话和摩托罗拉当时的CEO克里斯•加尔文争吵，具体吵了什么我们不知道，不过可以从后来两人的表现看出端倪，乔布斯后来称摩托罗拉的CEO克里斯是笨蛋，克里斯后来称乔布斯为混球。我想，当时的谈话一定不是在友好的气氛中进行的。公开撕逼以后，摩托罗拉随即停止生产StarMax电脑，苹果公司也开始抛弃PowerPC架构。

经过了一年的紧张工作，在2006年的MacWorld上，乔布斯站在舞台上，骄傲的宣称，Mac OS X的代码有8600万行，已经迁移完毕。
6
换“芯”大获成功
有了新版的XCode，原先的软件只需要重新编译一次，就可以在Mac上运行，而且，更换了CPU以后的mac是可以安装Windows的，借助苹果开发的BootCamp软件，用户可以在苹果电脑上安装双系统，借助Windows，苹果电脑的销量增加了10倍。

苹果公司这场声势浩大的换芯，真的就像非洲大草原上迁徙的角马，稍有不慎，就会成为狮子或者鳄鱼的午餐。毕竟，换芯的成功率和复杂度太难了，微软曾经干了六年，以失败告终。 但是，这次换芯成功以后，救活了Mac平台，挽救了苹果公司，随后才产生了iPhone的奇迹。
后记

这次音频就到这里，我其实还想说一下苹果公司换芯的技术细节。尤其是软件方面的技术细节，比如苹果为了能让软件可以同时运行在两个平台，使用了一种叫做通用二进制程序的技术，在同一个软件中提供两种架构的二进制代码，这样软件可以同时运行在PowerPC和x86平台上。包括在WWDC上，乔布斯亲自演示的Xcode 2.1编译器，如何编译两种代码等等。

但是，这个公众号，我心里还是希望能多几个关注者，满足我的虚荣心。如果我开始讲Rosetta模拟器如何将用户程序，翻译为Intel x86的指令，比如说，最初为了让Photoshop能运行在换芯以后的mac上，就是使用的这种技术，而且使用这种技术以后，虽然性能是慢了不少，但是大部分用户依然毫无感觉，主要的原因是什么？

但是，我也有点担心，我讲了这些以后，这个公众号可能就会完蛋了，最开始的时候，这个公众号只有十几个关注者的时候，我装逼发了一片我翻译的爱因斯坦的文章，一下子退订了5个人，本来十几个，接近一半的人退订了。
